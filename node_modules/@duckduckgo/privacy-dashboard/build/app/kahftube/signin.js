let isButtonClicked = false;
let isSigninClicked = false;

new MutationObserver(() => {
  const url = location.href;
  if (!url.includes("google")) {
    forceSignin();
  }
}).observe(document, { subtree: true, childList: true });

const forceSignin = async () => {
  const button = document
    .querySelector("ytm-topbar-menu-button-renderer")
    ?.children?.item(0);
  window.flutter_inappwebview.callHandler(
    "shouldRestart",
    button?.children?.item(0)?.children?.item(0)?.nodeName
  );
  if (button?.isConnected && !isButtonClicked) {
    isButtonClicked = true;
    button.click();
  }
  const signinButton = document.querySelector("a.compact-link-endpoint");
  // console.log(signinButton);
  if (signinButton?.isConnected && !isSigninClicked) {
    isSigninClicked = true;
    // console.log(signinButton.getAttribute("href"));
    window.flutter_inappwebview.callHandler(
      "getAuthUrl",
      signinButton.getAttribute("href")
    );
  }
};
